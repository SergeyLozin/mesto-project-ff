(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&t(e)}}function r(e){const o=e.querySelector(".popup__close");o&&o.addEventListener("click",(()=>t(e))),function(e){e.addEventListener("click",(o=>{o.target===e&&t(e)}))}(e)}function n(e,t,o,r,n){const c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image");a.src=e.link,a.alt=e.name,c.querySelector(".card__title").textContent=e.name;const i=c.querySelector(".card__delete-button");e.owner._id!==n?i.style.display="none":i.addEventListener("click",t);const s=c.querySelector(".card__like-button"),u=c.querySelector(".card__like-count");return u.textContent=e.likes.length,e.likes.some((e=>e._id===n))&&s.classList.add("card__like-button_is-active"),s.addEventListener("click",(()=>{o(s,e._id,u)})),a.addEventListener("click",(()=>{r(e)})),c}function c(e){e.target.closest(".card").remove()}function a(e,t,o){const r=e.classList.contains("card__like-button_is-active");fetch(`https://nomoreparties.co/v1/wff-cohort-37/cards/likes/${t}`,{method:r?"DELETE":"PUT",headers:{authorization:"d31f61de-0975-44cc-9988-d24422d9cf34","Content-Type":"application/json"}}).then((e=>e.json())).then((t=>{e.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})).catch((e=>console.error("Ошибка при обновлении лайка:",e)))}const i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"},s=(e,t,o)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},u=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(o)):(t.disabled=!1,t.classList.remove(o))},l=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((o=>{s(e,o,t)})),u(o,r,t.inactiveButtonClass)},d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"d31f61de-0975-44cc-9988-d24422d9cf34","Content-Type":"application/json"}};function p(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}let _;(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{t.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);u(o,r,t.inactiveButtonClass),o.forEach((n=>{n.addEventListener("input",(()=>{((e,t,o)=>{t.validity.valid?s(e,t,o):((e,t,o,r)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(r.inputErrorClass);const c=t.dataset.errorMessage||o;n.textContent=c,n.classList.add(r.errorClass)})(e,t,t.validationMessage,o)})(e,n,t),u(o,r,t.inactiveButtonClass)}))}))})(t,e)}))})(i);const m=document.querySelector(".places__list"),y=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),v=document.querySelector('[name="edit-profile"]'),S=document.querySelector('[name="new-place"]'),h=document.querySelector(".popup__input_type_name"),q=document.querySelector(".popup__input_type_description"),C=document.querySelector(".popup__input_type_card-name"),b=document.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_avatar"),E=document.querySelector('[name="edit-avatar"]'),k=document.querySelector(".popup__input_type_url"),x=document.querySelector(".profile__image");function g(t){const o=document.querySelector(".popup_type_image"),r=o.querySelector(".popup__image"),n=o.querySelector(".popup__caption");r.src=t.link,r.alt=t.name,n.textContent=t.name,e(o)}document.querySelector(".profile__edit-avatar").addEventListener("click",(()=>{k.value="",l(E,i),e(L)})),r(L),E.addEventListener("submit",(function(e){e.preventDefault();const o=e.submitter,r=o.textContent;var n;o.textContent="Сохранение...",(n=k.value,fetch(`${d.baseUrl}/users/me/avatar`,{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:n})}).then(p)).then((e=>{x.style.backgroundImage=`url(${e.avatar})`,t(L)})).catch((e=>console.error("Ошибка при обновлении аватара:",e))).finally((()=>{o.textContent=r}))})),Promise.all([fetch(`${d.baseUrl}/users/me`,{headers:d.headers}).then(p),fetch(`${d.baseUrl}/cards`,{headers:d.headers}).then(p)]).then((([e,t])=>{_=e._id,document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,t.forEach((e=>{const t=n(e,c,a,g,_);m.append(t)}))})).catch((e=>{console.error("Ошибка при загрузке данных:",e)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){h.value=document.querySelector(".profile__title").textContent,q.value=document.querySelector(".profile__description").textContent,l(v,i),e(y)})),r(y),document.querySelector(".profile__add-button").addEventListener("click",(function(){S.reset(),l(S,i),e(f)})),r(f),v.addEventListener("submit",(function(e){e.preventDefault(),document.querySelector(".profile__title").textContent=h.value,document.querySelector(".profile__description").textContent=q.value,t(y)})),S.addEventListener("submit",(function(e){e.preventDefault();const o=e.submitter,r=o.textContent;var i,s;o.textContent="Сохранение...",(i=C.value,s=b.value,fetch(`${d.baseUrl}/cards`,{method:"POST",headers:d.headers,body:JSON.stringify({name:i,link:s})}).then(p)).then((e=>{const o=n(e,c,a,g,_);m.prepend(o),S.reset(),t(f)})).catch((e=>console.error("Ошибка при создании карточки:",e))).finally((()=>{o.textContent=r}))})),r(document.querySelector(".popup_type_image"))})();